# from tkinter import Tk, Label, Button, Entry, IntVar, END, W, E, NE, StringVar, DoubleVar, WORD, Menu
# from tkinter import filedialog
import os
from tkinter.scrolledtext import ScrolledText
from tkinter import *
from tkinter import messagebox
# from tkinter.ttk import *
from reports import stats_by_ip, vulners_list_all_cmd, stats_by_group_cmd, stats_by_ip_cmd
from load_db import load_db
from DB import query_to_excel
from print_text_table import print_query

    
DATA_FOLDER=r"C:\Users\yahia\Documents\Vulner project\Qradar\09-2020 - Copy"
OUT_FOLDER = r"C:\Users\yahia\Documents\out"

def run_menu():
    root = Tk()
    #root.attributes('-fullscreen', True)
    root.state('zoomed')
    
    output = ScrolledText(root, width=160, height = 40, wrap = WORD, background = 'white')
    output.grid(row=1, column = 0, columnspan = 2, sticky = 'W')
    
    
    menu_bar = Menu(root)
    file_menu = Menu(menu_bar, tearoff=0)
    file_menu.add_command(label="Load Qradar files", command=lambda: load_db(DATA_FOLDER, output))
    file_menu.add_separator()
    file_menu.add_command(label="Exit", command=root.quit)
    menu_bar.add_cascade(label="Load", menu=file_menu)
    
    report_menu = Menu(menu_bar, tearoff = 0)
    report_menu.add_command(label="Stats by ip", command= lambda: print_query(stats_by_ip_cmd, output, "Stats by IP"))
    report_menu.add_command(label="Vulnerability All", command= lambda: print_query(vulners_list_all_cmd, output, "Vulnerability All" ))
    report_menu.add_command(label="Stats by VLAN Group", command= lambda: print_query(stats_by_group_cmd, output, "Stats by VLAN Group" ))
    menu_bar.add_cascade(label="Reports", menu=report_menu)

    
    export_menu = Menu(menu_bar, tearoff = 0)
    export_menu.add_command(label="Stats by ip", 
        command= lambda: query_to_excel(stats_by_ip_cmd, os.path.join(OUT_FOLDER, "stats_by_ip.xlsx")))
    export_menu.add_command(label="Vulnerability All", 
        command= lambda: query_to_excel(vulners_list_all_cmd, os.path.join(OUT_FOLDER, "vulners_list_all.xlsx")))
    export_menu.add_command(label="Stats by VLAN Group", 
        command= lambda: query_to_excel(stats_by_group_cmd, os.path.join(OUT_FOLDER, "stats_by_group.xlsx")))
    menu_bar.add_cascade(label="Export", menu=export_menu)

    root.config(menu=menu_bar)    
        
    root.mainloop()


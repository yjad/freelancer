<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="C:/Yahia/Python/src/Freelancer/vulnerability/data/vulnerability.sqlite" readonly="0" foreign_keys="" case_sensitive_like="" temp_store="" wal_autocheckpoint="" synchronous=""/><attached/><window><main_tabs open="structure browser pragmas query" current="1"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="3048"/><column_width id="4" width="0"/></tab_structure><tab_browse><current_table name="0,0:"/><default_encoding codec=""/><browse_table_settings/></tab_browse><tab_sql><sql name="create table stats">CREATE TABLE &quot;stats&quot; AS
select date('now') as &quot;Date&quot;, vlan_group as &quot;Group&quot;, location, COUNT(distinct assets.ipaddress) as &quot;numHosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress = vul.ipaddress
    GROUP by location, vlan_group
    ORDER BY 1,2 DESC</sql><sql name="Windows stats">SELECT  a.&quot;Group&quot;, a.Location, b.numHosts, a.total &quot;Base # Vulner.&quot;,
          b.total &quot;Last Scan #Vulner.&quot;, (a.total - b.total) as &quot;# Fixed&quot;, 
          ROUND(((a.total - b.total) *1.0 /a.total)* 100, 1) as &quot;Fixed %&quot; 
          FROM stats a INNER join stats b on a.&quot;group&quot; = b.&quot;group&quot; 
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-11-24&quot; AND a.Location = b.Location) 
UNION
SELECT  &quot;Total Vul&quot;, &quot;&quot;, sum(b.numHosts), sum(a.total),
          sum(b.total),sum (a.total - b.total), 
          ROUND(((sum(a.total) - sum(b.total)) *1.0 /sum(a.total))* 100, 1) 
          FROM stats a INNER join stats b on a.&quot;group&quot; = b.&quot;group&quot; 
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-11-24&quot; AND a.Location = b.Location) 
  ORDER BY 1</sql><sql name="SQL 4">select name,count(distinct ipaddress) as &quot;# of hosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability
    GROUP by name</sql><sql name="High Vulners stats All">select Location, vul.name, ast.assetName, ast.ipaddress, count(risk) as '# High Risk' 
    FROM vulnerability vul LEFT JOIN assets ast on vul.ipaddress = ast.ipaddress
    WHERE risk = 'High'
	group by location, vul.name, ast.ipaddress</sql><sql name="stats_all">select  vlan_group as &quot;Group&quot;, location, COUNT(distinct assets.ipaddress) as &quot;numHosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress = vul.ipaddress
    GROUP by location, vlan_group
    ORDER BY 1,2 DESC	</sql><sql name="vulner list by ip">SELECT ipaddress
FROM assets
WHERE 
ipaddress in (&quot;172.16.128.1&quot;,&quot;172.16.142.1&quot;,&quot;172.16.144.1&quot;,&quot;172.16.149.1&quot;,&quot;172.16.151.1&quot;,&quot;172.16.187.1&quot;,&quot;172.16.190.1&quot;,
&quot;172.16.195.1&quot;,&quot;172.16.195.1&quot;,&quot;172.16.207.1&quot;,&quot;172.16.212.1&quot;,&quot;172.16.214.1&quot;,&quot;172.16.217.1&quot;,&quot;172.16.224.1&quot;,&quot;172.16.229.1&quot;,
&quot;172.16.240.1&quot;,&quot;172.16.250.1&quot;,&quot;172.16.204.1&quot;,&quot;172.16.195.1&quot;)
--AND risk = 'High'

--172.17.93.50</sql><sql name="list by vlan group">select Location, vlan_group, name,ipaddress,vulnerability
    FROM vulnerability LEFT JOIN vlan on name = vlan
    WHERE risk = 'High' 
	AND vlan_group = 'Microsoft-Servers'</sql><sql name="vulners list all">select Location, vlan_group as &quot;Group&quot;, assets.ipaddress, assets.assetName,vulnerability, risk 
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress  = vul.ipaddress
    ORDER BY 1,2,3,4
</sql><sql name="stats_by_ip">select  vlan_group, location, assets.ipaddress, assets.assetName,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress = vul.ipaddress
    GROUP by location, vlan_group, assets.ipaddress
    ORDER BY 1,2 DESC</sql><sql name="SQL 20">SELECT  a.&quot;Group&quot;, a.Location, a.date as &quot;Base Date&quot;, b.date &quot;Scan Date&quot;, a.total &quot;Base Total&quot;, 
          b.total &quot;Scan Total&quot;, (a.total - b.total) as diff, ROUND(((a.total - b.total) *1.0 /a.total)* 100, 1) as &quot;Fixed %&quot; 
          FROM stats a inner join stats b on a.&quot;group&quot; = b.&quot;group&quot; 
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-11-20&quot; AND a.Location = b.Location)
          where diff &gt; 0</sql><sql name="SQL 12">select  vlan_group, location, 
    COUNT(distinct assets.ipaddress) as &quot;numHosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress = vul.ipaddress
    GROUP by location, vlan_group
    ORDER BY 1,2 DESC
	
	
	select *
	from vulnerability 
	where name like &quot;%BRANCHES%&quot;</sql><current_tab id="1"/></tab_sql></sqlb_project>

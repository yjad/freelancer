<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="C:/Yahia/Python/src/Freelancer/vulnerability/data/vulnerability.sqlite" readonly="0" foreign_keys="0" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="0" synchronous="1"/><attached/><window><main_tabs open="structure browser pragmas query" current="1"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="2766"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,5:mainstats"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="VLAN" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="2" value="341"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="assets" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="96"/><column index="2" value="300"/><column index="3" value="222"/><column index="4" value="216"/><column index="5" value="69"/><column index="6" value="183"/></column_widths><filter_values><column index="2" value="Core"/></filter_values><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="milestone" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="329"/><column index="2" value="70"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="role_profiles" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="79"/><column index="2" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="stats" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="7" mode="0"/></sort><column_widths><column index="1" value="73"/><column index="2" value="70"/><column index="3" value="216"/><column index="4" value="341"/><column index="5" value="42"/><column index="6" value="57"/><column index="7" value="40"/><column index="8" value="62"/><column index="9" value="42"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="vulnerability" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="16" mode="0"/></sort><column_widths><column index="1" value="230"/><column index="2" value="119"/><column index="3" value="87"/><column index="4" value="300"/><column index="5" value="62"/><column index="6" value="50"/><column index="7" value="48"/><column index="8" value="75"/><column index="9" value="300"/><column index="10" value="70"/><column index="11" value="98"/><column index="12" value="72"/><column index="13" value="300"/><column index="14" value="114"/><column index="15" value="118"/><column index="16" value="152"/><column index="17" value="40"/><column index="18" value="46"/><column index="19" value="95"/><column index="20" value="300"/><column index="21" value="92"/><column index="22" value="68"/><column index="23" value="88"/><column index="24" value="300"/><column index="25" value="89"/><column index="26" value="81"/><column index="27" value="44"/><column index="28" value="89"/></column_widths><filter_values><column index="14" value="172.17.77.166"/></filter_values><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="progress by group">SELECT  a.&quot;Group&quot;, a.Location, b.numHosts, a.total &quot;Base # Vulner.&quot;,
          b.total &quot;Last Scan #Vulner.&quot;, (a.total - b.total) as &quot;# Fixed&quot;, 
          ROUND(((a.total - b.total) *1.0 /a.total)* 100, 1) as &quot;Fixed %&quot; 
          FROM stats a INNER join stats b on a.&quot;group&quot; = b.&quot;group&quot; 
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-11-24&quot; AND a.Location = b.Location) 
UNION
SELECT  &quot;Total Vul&quot;, &quot;&quot;, sum(b.numHosts), sum(a.total),
          sum(b.total),sum (a.total - b.total), 
          ROUND(((sum(a.total) - sum(b.total)) *1.0 /sum(a.total))* 100, 1) 
          FROM stats a INNER join stats b on a.&quot;group&quot; = b.&quot;group&quot; 
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-11-24&quot; AND a.Location = b.Location) 
  ORDER BY 1</sql><sql name="stats by group">select vlan_group, count(distinct vul.ipaddress) as &quot;# of hosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress = vul.ipaddress
    GROUP by vlan_group
UNION
SELECT &quot;Total&quot;, count(distinct vul.ipaddress) as &quot;# of hosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul LEFT JOIN assets on assets.ipaddress = vul.ipaddress
</sql><sql name="stats by milestone">select  milestone, vlan_group,  count(distinct vul.ipaddress) as &quot;# of hosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul 
		LEFT JOIN assets on assets.ipaddress = vul.ipaddress
		LEFT JOIN milestone ms on vul.name = ms.profile_name
    GROUP by vlan_group, ms.milestone
UNION
SELECT  &quot;ToTAL&quot;,&quot;&quot;, count(distinct vul.ipaddress) as &quot;# of hosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul 
		
	</sql><sql name="progress by milestone">SELECT  b.milestone, b.profile_group, a.numHosts &quot;Base mumHosts&quot;, b.numHosts &quot;last scan # hosts&quot;,
          a.total &quot;Base # Vulner.&quot;,
          b.total &quot;Last Scan #Vulner.&quot;, (a.total - b.total) as &quot;# Fixed&quot;,
          ROUND(((a.total - b.total) *1.0 /a.total)* 100, 1) as &quot;Fixed %&quot;
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-01&quot;)
UNION
SELECT  &quot;Total &quot;, &quot;&quot;, sum(a.numHosts), sum(b.numHosts), sum(a.total),
          sum(b.total),sum (a.total - b.total),
          ROUND(((sum(a.total) - sum(b.total)) *1.0 /sum(a.total))* 100, 1)
          FROM stats a INNER join stats b on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-01&quot;)
  ORDER BY 1
  
</sql><sql name="Preogress by milestone - summary">SELECT milestone, &quot;&quot;,sum (BH) &quot;Base # Hosts&quot;, sum(LH) &quot;Last Scan # Hosts&quot;, sum (BT) &quot;Base # Vulner&quot;, sum(LT) &quot;Last Scan # Vulner&quot;, (sum (BT) - sum(LT)) as &quot;# Fixed&quot;, 
         ROUND((sum (BT) - sum(LT))*1.0 /sum(BT)* 100.0, 1) as &quot;Fixed %&quot;
FROM (
SELECT  b.milestone, a.numHosts BH, b.numHosts LH,
          a.total BT,
          b.total LT, (a.total - b.total) as F
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-01&quot;)
	 
)
GROUP BY milestone
UNION
SELECT &quot;Total&quot;, &quot;&quot;,sum (BH) &quot;Base # Hosts&quot;, sum(LH) &quot;Last Scan # Hosts&quot;, sum (BT) &quot;Base # Vulner&quot;, sum(LT) &quot;Last Scan # Vulner&quot;, (sum (BT) - sum(LT)) as &quot;# Fixed&quot;, 
         ROUND((sum (BT) - sum(LT))*1.0 /sum(BT)* 100.0, 1) as &quot;Fixed %&quot;
FROM (
SELECT  b.milestone, a.numHosts BH, b.numHosts LH,
          a.total BT,
          b.total LT, (a.total - b.total) as F
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-01&quot;)
  )
</sql><sql name="stats by milestone (1)">select  milestone, vlan_group,  ms.profile_name, count(distinct vul.ipaddress) as &quot;# of hosts&quot;,
	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
	COUNT(risk) as &quot;Total&quot;
    FROM vulnerability vul 
		LEFT JOIN assets on assets.ipaddress = vul.ipaddress
		LEFT JOIN milestone ms on vul.name = ms.profile_name
-- 	WHERE ms.pofile_mame != &quot;&quot;
    GROUP by vlan_group, ms.milestone, ms.profile_name

-- UNION
-- SELECT  &quot;ToTAL&quot;,&quot;&quot;, &quot;&quot;, count(distinct vul.ipaddress) as &quot;# of hosts&quot;,
-- 	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
-- 	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
-- 	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
-- 	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
-- 	COUNT(risk) as &quot;Total&quot;
--     FROM vulnerability vul 
		
order by 2</sql><sql name="Progress by group">    SELECT  b.milestone, b.profile_group, a.numHosts &quot;Base mumHosts&quot;, b.numHosts &quot;last scan # hosts&quot;,
          a.total &quot;Base # Vulner.&quot;,
          b.total &quot;Last Scan #Vulner.&quot;, (a.total - b.total) as &quot;# Fixed&quot;,
          ROUND(((a.total - b.total) *1.0 /a.total)* 100, 1) as &quot;Fixed %&quot;
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND (a.date = &quot;{base_date}&quot; AND b.date = &quot;{last_date}&quot;)
</sql><sql name="Validation">-- select  milestone, vlan_group,  name, vul.ipaddress, count(distinct vul.ipaddress) as &quot;# of hosts&quot;
-- 	COUNT(CASE WHEN risk = 'High' Then 1 END) as 'High', 
-- 	COUNT(CASE WHEN risk = 'Medium' Then 1 END) as 'Medium',
-- 	COUNT(CASE WHEN risk = 'Low' Then 1 END) as 'Low',
-- 	COUNT(CASE WHEN risk = 'Warning' Then 1 END) as 'Warning',
-- 	COUNT(risk) as &quot;Total&quot;
--     FROM vulnerability vul 
-- 		LEFT JOIN assets on assets.ipaddress = vul.ipaddress
-- 		LEFT JOIN milestone ms on vul.name = ms.profile_name
-- 
-- 	WHERE vlan_group like &quot;AIX-Servers&quot; AND milestone = 1

select name, profile_name FROM vulnerability v LEFT JOIN assets a on name = a.profile_name
GROUP BY profile_name
HAVING profile_name is NULL

select v.ipaddress, name, profile_name  FROM vulnerability v LEFT JOIN assets a using (ipaddress)
GROUP BY profile_name
HAVING profile_name is NULL

SELECT assets.profile_name, milestone from assets left join milestone using (profile_name)
GROUP BY profile_name 
HAVING profile_name is NULL
	</sql><sql name="SQL 10">SELECT milestone, sum (BH) &quot;Base # Hosts&quot;, sum(LH) &quot;Last Scan # Hosts&quot;, sum (BT) &quot;Base # Vulner&quot;, sum(LT) &quot;Last Scan # Vulner&quot;, (sum (BT) - sum(LT)) as &quot;# Fixed&quot;, 
         ROUND((sum (BT) - sum(LT))*1.0 /sum(BT)* 100.0, 1) as &quot;Fixed %&quot;
FROM (
SELECT  b.milestone, a.numHosts BH, b.numHosts LH,
          a.total BT,
          b.total LT, (a.total - b.total) as F
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND a.profile_name = b.profile_name
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-02&quot;)
)
GROUP BY milestone
UNION
SELECT milestone, sum (BH) &quot;Base # Hosts&quot;, sum(LH) &quot;Last Scan # Hosts&quot;, 
        sum (BT) &quot;Base # Vulner&quot;, sum(LT) &quot;Last Scan # Vulner&quot;, (sum (BT) - sum(LT)) as &quot;# Fixed&quot;, 
        ROUND((sum (BT) - sum(LT))*1.0 /sum(BT)* 100.0, 1) as &quot;Fixed %&quot;
FROM (
SELECT  a.milestone,  a.numHosts BH, b.numHosts LH,
          a.total BT,
          b.total LT, (a.total - b.total) as F
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND a.profile_name = b.profile_name
          AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-02&quot;)
)</sql><sql name="SQL 11">SELECT profile_group, sum (BH) &quot;Base # Hosts&quot;, sum(LH) &quot;Last Scan # Hosts&quot;, 
        sum (BT) &quot;Base # Vulner&quot;, sum(LT) &quot;Last Scan # Vulner&quot;, (sum (BT) - sum(LT)) as &quot;# Fixed&quot;, 
        ROUND((sum (BT) - sum(LT))*1.0 /sum(BT)* 100.0, 1) as &quot;Fixed %&quot;
FROM (
SELECT  a.profile_group, a.numHosts BH, b.numHosts LH,
          (a.High + a.Medium) BT,
          (b.High + b.Medium) LT, (a.High + a.Medium - b.High - b.Medium) as F
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND a.profile_name = b.profile_name
           AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-02&quot;)
)
GROUP BY profile_group
UNION
SELECT &quot;Total&quot;, sum (BH) &quot;Base # Hosts&quot;, sum(LH) &quot;Last Scan # Hosts&quot;, sum (BT) &quot;Base # Vulner&quot;, sum(LT) &quot;Last Scan # Vulner&quot;, (sum (BT) - sum(LT)) as &quot;# Fixed&quot;, 
         ROUND((sum (BT) - sum(LT))*1.0 /sum(BT)* 100.0, 1) as &quot;Fixed %&quot;
FROM (
SELECT  a.profile_group, a.numHosts BH, b.numHosts LH,
          (a.High + a.Medium) BT,
          (b.High + b.Medium) LT, (a.High + a.Medium - b.High - b.Medium) as F
          FROM stats b INNER join stats a on a.profile_group = b.profile_group AND a.milestone = b.milestone
          AND a.profile_name = b.profile_name
           AND (a.date = &quot;2020-09-22&quot; AND b.date = &quot;2020-12-02&quot;)
  )</sql><current_tab id="9"/></tab_sql></sqlb_project>

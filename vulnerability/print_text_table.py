from tkinter import END
from tabulate import tabulate
from DB import query_to_list
# from reports import vulners_list_all, stats_by_group_cmd
import textwrap

def wrap(string, lenght=15):
    return '\n'.join(textwrap.wrap(string, lenght))
    
def print_query(cmd,  output, title, max_len=30):
    
    if type(cmd) == str:
        header, rows = query_to_list(cmd)
    else:
        header, rows = cmd()        # a function that returns header & rows
    if max_len:     # wrap long fields at 30 chars
        new_rows = []
        for i,r in enumerate(rows):
            w_row = []
            for j, c in enumerate(r):
                if len (str(c)) > max_len:
                    w_row.append(wrap(c, max_len))
                else:
                    w_row.append(c)
            new_rows.append(w_row)

        table = tabulate(new_rows, headers=header, showindex="always")
    else:
        table = tabulate(rows, headers=header, showindex="always")
        
    output.delete(0.0, END)        # clear window
    output.insert(END, title+ '\n\n')
    for line in table:
        output.insert(END, line)
    
    